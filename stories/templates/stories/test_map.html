test_map.html

<!DOCTYPE html>
<html>
<head>
    <title>íˆì„œë¸Œí† ë¦¬ í†µí•© í…ŒìŠ¤íŠ¸</title>
    <style>
        .station-btn { padding: 10px; margin: 5px; cursor: pointer; border: 1px solid #ccc; background: white; }
        .visited { color: green; border: 2px solid green; font-weight: bold; }
        #display-area, #mypage-area { margin-top: 20px; padding: 20px; border: 1px solid #333; min-height: 150px; border-radius: 10px; }
        #display-area { border-style: dashed; background-color: #f9f9f9; }
        #mypage-area { border-style: solid; background-color: #fff; }
        .image-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .episode-img { width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .caption { font-size: 0.8em; color: #666; text-align: center; }
        .saved-item { display: inline-block; width: 120px; margin: 10px; vertical-align: top; text-align: center; }
    </style>
</head>
<body>
    <h1>ğŸš‡ íˆì„œë¸Œí† ë¦¬ í†µí•© í…ŒìŠ¤íŠ¸</h1>
    
    <div id="station-list">
        {% for item in station_data %}
            <button class="station-btn {% if item.is_visited %}visited{% endif %}" 
                    onclick="selectStation(event, {{ item.station.id }})">
                {{ item.station.name }}
            </button>
        {% endfor %}
    </div>

    <div id="display-area">
        <h3 id="episode-title">ê²°ê³¼ í™”ë©´</h3>
        <p id="episode-summary">ì—­ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.</p>
        <div id="image-container" class="image-grid"></div>
        <div id="action-button" style="margin-top: 20px;"></div>
    </div>

    <hr>

    <h2>ğŸ“‚ ë§ˆì´í˜ì´ì§€ í…ŒìŠ¤íŠ¸</h2>
    <button onclick="loadMyPage()" style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
        ë§ˆì´í˜ì´ì§€ ì •ë³´ ìƒˆë¡œê³ ì¹¨
    </button>
    <div id="mypage-area">
        <p>ë²„íŠ¼ì„ ëˆŒëŸ¬ ì €ì¥ëœ ì´ì•¼ê¸°ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
    </div>

    <script>
        // ì—í”¼ì†Œë“œ ì„ íƒ í•¨ìˆ˜
        async function selectStation(event, sId) {
            const title = document.getElementById('episode-title');
            const summary = document.getElementById('episode-summary');
            const container = document.getElementById('image-container');
            const actionBtn = document.getElementById('action-button');

            title.innerText = "â³ ìƒì„± ì¤‘...";
            summary.innerText = "AIê°€ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤. (ì•½ 30~40ì´ˆ ì†Œìš”)";
            container.innerHTML = ''; 
            actionBtn.innerHTML = '';

            try {
                const response = await fetch(`/api/stories/select/${sId}/`);
                const data = await response.json();

                if (response.ok) {
                    title.innerText = data.title;
                    summary.innerText = data.history_summary;

                    if (data.images && data.images.length > 0) {
                        data.images.forEach(img => {
                            const div = document.createElement('div');
                            div.innerHTML = `
                                <img src="${img.url}" class="episode-img">
                                <p class="caption">${img.caption}</p>
                            `;
                            container.appendChild(div);
                        });
                    }
                    actionBtn.innerHTML = `<button onclick="saveStory(${data.id})" style="padding: 10px; background-color: #28a745; color: white; border: none; border-radius: 5px;">â­ ì´ ì´ì•¼ê¸° ë‚´ ë³´ê´€í•¨ì— ì €ì¥í•˜ê¸°</button>`;
                    event.target.classList.add('visited');
                }
            } catch (e) {
                console.error("ì—ëŸ¬ ë°œìƒ:", e);
                title.innerText = "ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
            }
        }

        // ì´ì•¼ê¸° ì €ì¥ í•¨ìˆ˜
        async function saveStory(epId) {
            const res = await fetch(`/api/library/save/${epId}/`, { 
                method: 'POST', 
                headers: {'X-CSRFToken': '{{ csrf_token }}'} 
            });
            const json = await res.json();
            alert(json.message);
            loadMyPage(); // ì €ì¥ í›„ ë§ˆì´í˜ì´ì§€ ìë™ ê°±ì‹ 
        }

        // ë§ˆì´í˜ì´ì§€ ë¡œë“œ í•¨ìˆ˜ (ë³µêµ¬ë¨!)
        async function loadMyPage() {
    try {
        const res = await fetch(`/api/library/mypage/`);
        const json = await res.json();
        
        // 1. ìµœê·¼ ë³¸ ì—­ì‚¬ (ëª©ì°¨) ë¶€ë¶„
        let html = "<h4>ğŸ•’ ìµœê·¼ ë³¸ ì—­ì‚¬ (ëª©ì°¨ í´ë¦­ ì‹œ ë‹¤ì‹œë³´ê¸°)</h4><ul>";
        json.recent_stories.forEach(s => {
            // s.station_idê°€ undefinedê°€ ë˜ì§€ ì•Šë„ë¡ ë°±ì—”ë“œ keyê°’ê³¼ ë§ì¶°ì¤ë‹ˆë‹¤.
            html += `
                <li style="cursor:pointer; color:blue; text-decoration:underline; margin-bottom:5px;" 
                    onclick="selectStation(event, ${s.station_id})">
                    <strong>${s.station}</strong> (${s.last_viewed})
                </li>`;
        });
        html += "</ul><hr>";

        // 2. ì €ì¥ëœ ë³´ê´€í•¨ (ì´ë¯¸ì§€) ë¶€ë¶„
        html += "<h4>â­ ì €ì¥ëœ ë³´ê´€í•¨ (ì´ë¯¸ì§€ í´ë¦­ ì‹œ ë‹¤ì‹œë³´ê¸°)</h4>";
        if (json.saved_stories.length === 0) {
            html += "<p>ì €ì¥ëœ ì´ì•¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
        } else {
            json.saved_stories.forEach(s => {
                html += `
                    <div class="saved-item" onclick="selectStation(event, ${s.station_id})" style="cursor:pointer;">
                        <img src="${s.image}" style="width:100px; height:100px; object-fit: cover; border-radius: 5px;">
                        <br><strong>${s.station}</strong>
                    </div>`;
            });
        }
        document.getElementById('mypage-area').innerHTML = html;
    } catch (e) {
        console.error("ë§ˆì´í˜ì´ì§€ ë¡œë”© ì—ëŸ¬:", e);
    }
}
    </script>
</body>
</html>